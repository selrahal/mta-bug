<?xml version="1.0"?>
<ruleset id="api-usage" xmlns="http://windup.jboss.org/schema/jboss-ruleset" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://windup.jboss.org/schema/jboss-ruleset http://windup.jboss.org/schema/jboss-ruleset/windup-jboss-ruleset.xsd">
    <metadata>
        <description>
            This ruleset detects microservices that expose APIs.
        </description>
        <targetTechnology id="cloud-readiness" />
        <tag>api</tag>
    </metadata>
    <rules>
        <rule id="api-usage-00001">
            <when>
                    <javaclass references="org.springframework.web.bind.annotation.GetMapping">
                        <location>ANNOTATION</location>
                    </javaclass> 
                    <javaclass references="org.springframework.web.bind.annotation.RequestMapping">
                        <location>ANNOTATION</location>
                    </javaclass> 
            </when>
            <perform>
                <hint title="File system - Java IO" effort="1" category-id="cloud-mandatory">
                    <message>
                    An application running inside a container could lose access to a file in local storage.

                    Recommendations

                    The following recommendations depend on the function of the file in local storage:

                    * Logging: Log to standard output and use a centralized log collector to analyze the logs.
                    * Caching: Use a cache backing service.
                    * Configuration: Store configuration settings in environment variables so that they can be updated without code changes.
                    * Data storage: Use a database backing service for relational data or use a persistent data storage system.
                    * Temporary data storage: Use the file system of a running container as a brief, single-transaction cache.
                    </message>
                    <link href="https://12factor.net/logs" title="Twelve-Factor App: Logs"/>
                    <link href="https://docs.openshift.com/container-platform/4.5/logging/cluster-logging.html" title="OpenShift Container Platform: Understanding cluster logging"/>
                    <link href="https://12factor.net/backing-services" title="Twelve-Factor App: Backing services"/>
                    <link href="https://12factor.net/config" title="Twelve-Factor App: Config"/>
                    <link href="https://docs.openshift.com/container-platform/4.5/builds/creating-build-inputs.html#builds-input-secrets-configmaps_creating-build-inputs" title="OpenShift Container Platform: Input secrets and ConfigMaps"/>
                    <link href="https://docs.openshift.com/container-platform/4.5/storage/understanding-persistent-storage.html" title="OpenShift Container Platform: Understanding persistent storage"/>
                    <tag>storage</tag>
                </hint>
                <technology-identified name="Exposed APIs">
                    <tag name="API"/>
                </technology-identified>
            </perform>
        </rule>
    </rules>
</ruleset>
